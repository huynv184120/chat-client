{"ast":null,"code":"var _jsxFileName = \"/home/huy/chat-module/chat-client/src/App.js\",\n    _s = $RefreshSig$();\n\nimport './App.css';\nimport Auth from './component/auth';\nimport { makeStyles } from '@material-ui/core';\nimport { SearchRoom } from './component/room';\nimport ChatRoom from './component/chatwindow';\nimport Cookies from 'js-cookie';\nimport { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport io from \"socket.io-client\";\nimport config from './config';\nimport socketEvent from './socket_io/events';\nimport { changeRoomInfo, joinRoom, loadRooms, updateLastMessage } from \"./redux/actions/room\";\nimport { addMessage, loadMessages, updateMessage } from './redux/actions/message';\nimport { roomApi, messageApi, userApi } from './api';\nimport { loadMyInfo, loadUsers, updateMemberInfo } from './redux/actions/user';\nimport { receiveInvitation, loadInvitations } from './redux/actions/announce';\nimport ChatAppBar from './component/ChatAppBar';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(() => {\n  return {\n    appBar: {\n      height: \"70px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      paddingLeft: \"30px\",\n      paddingRight: \"30px\"\n    },\n    \"@global\": {\n      \"*::-webkit-scrollbar\": {\n        width: \"4px\"\n      },\n      \"*::-webkit-scrollbar-track\": {\n        \"-webkit-box-shadow\": \"inset 0 0 2px rgba(0,0,0,0.00)\"\n      },\n      \"*::-webkit-scrollbar-thumb\": {\n        backgroundColor: \"rgba(0,0,0,0.05)\",\n        outline: \"0.5px solid slategrey\"\n      }\n    }\n  };\n});\nconst socket = io(config.END_POINT, {\n  withCredentials: true\n});\n\nconst App = () => {\n  _s();\n\n  const classes = useStyles();\n  const auth = Cookies.get('token');\n  const dispatch = useDispatch();\n  useEffect(async () => {\n    if (auth) {\n      const res = await roomApi.getRooms();\n      const rooms = res.data;\n      dispatch(loadRooms(rooms));\n      const listRoomMess = rooms.map(room => messageApi.getMessages(room._id));\n      await Promise.all(listRoomMess);\n      const users = res.users;\n      dispatch(loadMyInfo(res.myInfo));\n      dispatch(loadUsers(users));\n      listRoomMess.forEach(element => {\n        element.then(data => {\n          dispatch(loadMessages(data));\n          dispatch(updateLastMessage({\n            room_id: data.room_id,\n            lastMessage: data.messages[data.messages.length - 1]\n          }));\n        });\n      });\n      const invitations = userApi.getinvitations();\n      invitations.then(data => {\n        dispatch(loadInvitations(data));\n      }).catch(() => {});\n      socket.emit(socketEvent.online, {\n        token: auth\n      });\n      socket.on(socketEvent.updateMemberInfo, data => {\n        dispatch(updateMemberInfo(data));\n      });\n      socket.on(socketEvent.joinRoom, async room => {\n        dispatch(joinRoom(room));\n        const data = await messageApi.getMessages(room._id);\n        dispatch(loadMessages(data));\n      });\n      socket.on(socketEvent.addMessage, message => {\n        dispatch(addMessage(message));\n        dispatch(updateLastMessage({\n          room_id: message.to,\n          lastMessage: message\n        }));\n      });\n      socket.on(socketEvent.invite, data => {\n        dispatch(receiveInvitation(data));\n      });\n      socket.on(socketEvent.updateRoom, data => {\n        dispatch(changeRoomInfo(data));\n      });\n      socket.on(socketEvent.updateRoomInfo, data => {\n        dispatch(changeRoomInfo(data));\n      });\n      socket.on(socketEvent.updateMessage, message => {\n        dispatch(updateMessage(message));\n      });\n    }\n\n    return () => {\n      socket.removeAllListeners();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [!auth && /*#__PURE__*/_jsxDEV(Auth, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 19\n    }, this), auth && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.appBar,\n        children: /*#__PURE__*/_jsxDEV(ChatAppBar, {\n          socket: socket\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: \"flex\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(SearchRoom, {\n          socket: socket\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(ChatRoom, {\n          socket: socket\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 16\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n};\n\n_s(App, \"Y9tZvcqC0bKJ4LE1NdhuzeAtVFg=\", false, function () {\n  return [useStyles, useDispatch];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["Auth","makeStyles","SearchRoom","ChatRoom","Cookies","useEffect","useState","useDispatch","io","config","socketEvent","changeRoomInfo","joinRoom","loadRooms","updateLastMessage","addMessage","loadMessages","updateMessage","roomApi","messageApi","userApi","loadMyInfo","loadUsers","updateMemberInfo","receiveInvitation","loadInvitations","ChatAppBar","useStyles","appBar","height","display","alignItems","paddingLeft","paddingRight","width","backgroundColor","outline","socket","END_POINT","withCredentials","App","classes","auth","get","dispatch","res","getRooms","rooms","data","listRoomMess","map","room","getMessages","_id","Promise","all","users","myInfo","forEach","element","then","room_id","lastMessage","messages","length","invitations","getinvitations","catch","emit","online","token","on","message","to","invite","updateRoom","updateRoomInfo","removeAllListeners"],"sources":["/home/huy/chat-module/chat-client/src/App.js"],"sourcesContent":["import './App.css';\nimport Auth from './component/auth';\nimport { makeStyles } from '@material-ui/core';\nimport { SearchRoom } from './component/room';\nimport ChatRoom from './component/chatwindow';\nimport Cookies from 'js-cookie';\nimport { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport io from \"socket.io-client\";\nimport config from './config';\nimport socketEvent from './socket_io/events';\nimport { changeRoomInfo, joinRoom, loadRooms, updateLastMessage } from \"./redux/actions/room\";\nimport { addMessage, loadMessages, updateMessage } from './redux/actions/message';\nimport { roomApi, messageApi, userApi } from './api';\nimport { loadMyInfo, loadUsers, updateMemberInfo } from './redux/actions/user';\nimport { receiveInvitation, loadInvitations } from './redux/actions/announce';\nimport ChatAppBar from './component/ChatAppBar';\n\nconst useStyles = makeStyles(() => {\n  return ({\n    appBar: {\n      height: \"70px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      paddingLeft: \"30px\",\n      paddingRight: \"30px\",\n\n    },\n    \"@global\": {\n      \"*::-webkit-scrollbar\": {\n        width: \"4px\",\n      },\n      \"*::-webkit-scrollbar-track\": {\n        \"-webkit-box-shadow\": \"inset 0 0 2px rgba(0,0,0,0.00)\"\n      },\n      \"*::-webkit-scrollbar-thumb\": {\n        backgroundColor: \"rgba(0,0,0,0.05)\",\n        outline: \"0.5px solid slategrey\"\n      }\n    }\n  })\n})\n\nconst socket = io(config.END_POINT, { withCredentials: true });\n\nconst App = () => {\n  const classes = useStyles();\n  const auth = Cookies.get('token');\n  const dispatch = useDispatch();\n\n\n\n  useEffect(async () => {\n    if (auth) {\n\n      const res = await roomApi.getRooms();\n      const rooms = res.data;\n      dispatch(loadRooms(rooms));\n\n      const listRoomMess = rooms.map((room) => messageApi.getMessages(room._id));\n      await Promise.all(listRoomMess);\n      const users = res.users;\n      dispatch(loadMyInfo(res.myInfo));\n      dispatch(loadUsers(users));\n\n      listRoomMess.forEach(element => {\n        element.then((data) => {\n          dispatch(loadMessages(data));\n          dispatch(updateLastMessage({ room_id: data.room_id, lastMessage: data.messages[data.messages.length - 1] }));\n        })\n      });\n\n      const invitations = userApi.getinvitations();\n      invitations.then((data) => {\n        dispatch(loadInvitations(data));\n      }).catch(() => { })\n\n\n      socket.emit(socketEvent.online, { token: auth });\n\n      socket.on(socketEvent.updateMemberInfo, (data) => {\n        dispatch(updateMemberInfo(data));\n      });\n\n      socket.on(socketEvent.joinRoom, async (room) => {\n        dispatch(joinRoom(room));\n        const data = await messageApi.getMessages(room._id);\n        dispatch(loadMessages(data));\n\n      });\n\n      socket.on(socketEvent.addMessage, (message) => {\n        dispatch(addMessage(message));\n        dispatch(updateLastMessage({ room_id: message.to, lastMessage: message }));\n      });\n\n      socket.on(socketEvent.invite, (data) => {\n        dispatch(receiveInvitation(data));\n      });\n\n      socket.on(socketEvent.updateRoom, (data) => {\n        dispatch(changeRoomInfo(data));\n      });\n      socket.on(socketEvent.updateRoomInfo, (data) => {\n        dispatch(changeRoomInfo(data));\n      });\n\n      socket.on(socketEvent.updateMessage, (message)=> {\n        dispatch(updateMessage(message));\n      });\n    }\n    return () => {\n      socket.removeAllListeners();\n    }\n\n  }, [])\n\n\n\n  return (\n    <div className=\"App\">\n      {(!auth) && <Auth />}\n      {auth && <div>\n        <div className={classes.appBar}>\n          <ChatAppBar socket={socket} />\n        </div>\n        <div style={{ display: \"flex\" }}>\n          <SearchRoom socket={socket} />\n          <ChatRoom socket={socket} />\n        </div>\n      </div>}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":";;;AAAA,OAAO,WAAP;AACA,OAAOA,IAAP,MAAiB,kBAAjB;AACA,SAASC,UAAT,QAA2B,mBAA3B;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,QAAP,MAAqB,wBAArB;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,SAASC,SAAT,EAAoBC,QAApB,QAAoC,OAApC;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,WAAP,MAAwB,oBAAxB;AACA,SAASC,cAAT,EAAyBC,QAAzB,EAAmCC,SAAnC,EAA8CC,iBAA9C,QAAuE,sBAAvE;AACA,SAASC,UAAT,EAAqBC,YAArB,EAAmCC,aAAnC,QAAwD,yBAAxD;AACA,SAASC,OAAT,EAAkBC,UAAlB,EAA8BC,OAA9B,QAA6C,OAA7C;AACA,SAASC,UAAT,EAAqBC,SAArB,EAAgCC,gBAAhC,QAAwD,sBAAxD;AACA,SAASC,iBAAT,EAA4BC,eAA5B,QAAmD,0BAAnD;AACA,OAAOC,UAAP,MAAuB,wBAAvB;;AAEA,MAAMC,SAAS,GAAG1B,UAAU,CAAC,MAAM;EACjC,OAAQ;IACN2B,MAAM,EAAE;MACNC,MAAM,EAAE,MADF;MAENC,OAAO,EAAE,MAFH;MAGNC,UAAU,EAAE,QAHN;MAINC,WAAW,EAAE,MAJP;MAKNC,YAAY,EAAE;IALR,CADF;IASN,WAAW;MACT,wBAAwB;QACtBC,KAAK,EAAE;MADe,CADf;MAIT,8BAA8B;QAC5B,sBAAsB;MADM,CAJrB;MAOT,8BAA8B;QAC5BC,eAAe,EAAE,kBADW;QAE5BC,OAAO,EAAE;MAFmB;IAPrB;EATL,CAAR;AAsBD,CAvB2B,CAA5B;AAyBA,MAAMC,MAAM,GAAG7B,EAAE,CAACC,MAAM,CAAC6B,SAAR,EAAmB;EAAEC,eAAe,EAAE;AAAnB,CAAnB,CAAjB;;AAEA,MAAMC,GAAG,GAAG,MAAM;EAAA;;EAChB,MAAMC,OAAO,GAAGd,SAAS,EAAzB;EACA,MAAMe,IAAI,GAAGtC,OAAO,CAACuC,GAAR,CAAY,OAAZ,CAAb;EACA,MAAMC,QAAQ,GAAGrC,WAAW,EAA5B;EAIAF,SAAS,CAAC,YAAY;IACpB,IAAIqC,IAAJ,EAAU;MAER,MAAMG,GAAG,GAAG,MAAM3B,OAAO,CAAC4B,QAAR,EAAlB;MACA,MAAMC,KAAK,GAAGF,GAAG,CAACG,IAAlB;MACAJ,QAAQ,CAAC/B,SAAS,CAACkC,KAAD,CAAV,CAAR;MAEA,MAAME,YAAY,GAAGF,KAAK,CAACG,GAAN,CAAWC,IAAD,IAAUhC,UAAU,CAACiC,WAAX,CAAuBD,IAAI,CAACE,GAA5B,CAApB,CAArB;MACA,MAAMC,OAAO,CAACC,GAAR,CAAYN,YAAZ,CAAN;MACA,MAAMO,KAAK,GAAGX,GAAG,CAACW,KAAlB;MACAZ,QAAQ,CAACvB,UAAU,CAACwB,GAAG,CAACY,MAAL,CAAX,CAAR;MACAb,QAAQ,CAACtB,SAAS,CAACkC,KAAD,CAAV,CAAR;MAEAP,YAAY,CAACS,OAAb,CAAqBC,OAAO,IAAI;QAC9BA,OAAO,CAACC,IAAR,CAAcZ,IAAD,IAAU;UACrBJ,QAAQ,CAAC5B,YAAY,CAACgC,IAAD,CAAb,CAAR;UACAJ,QAAQ,CAAC9B,iBAAiB,CAAC;YAAE+C,OAAO,EAAEb,IAAI,CAACa,OAAhB;YAAyBC,WAAW,EAAEd,IAAI,CAACe,QAAL,CAAcf,IAAI,CAACe,QAAL,CAAcC,MAAd,GAAuB,CAArC;UAAtC,CAAD,CAAlB,CAAR;QACD,CAHD;MAID,CALD;MAOA,MAAMC,WAAW,GAAG7C,OAAO,CAAC8C,cAAR,EAApB;MACAD,WAAW,CAACL,IAAZ,CAAkBZ,IAAD,IAAU;QACzBJ,QAAQ,CAACnB,eAAe,CAACuB,IAAD,CAAhB,CAAR;MACD,CAFD,EAEGmB,KAFH,CAES,MAAM,CAAG,CAFlB;MAKA9B,MAAM,CAAC+B,IAAP,CAAY1D,WAAW,CAAC2D,MAAxB,EAAgC;QAAEC,KAAK,EAAE5B;MAAT,CAAhC;MAEAL,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACa,gBAAtB,EAAyCyB,IAAD,IAAU;QAChDJ,QAAQ,CAACrB,gBAAgB,CAACyB,IAAD,CAAjB,CAAR;MACD,CAFD;MAIAX,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACE,QAAtB,EAAgC,MAAOuC,IAAP,IAAgB;QAC9CP,QAAQ,CAAChC,QAAQ,CAACuC,IAAD,CAAT,CAAR;QACA,MAAMH,IAAI,GAAG,MAAM7B,UAAU,CAACiC,WAAX,CAAuBD,IAAI,CAACE,GAA5B,CAAnB;QACAT,QAAQ,CAAC5B,YAAY,CAACgC,IAAD,CAAb,CAAR;MAED,CALD;MAOAX,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACK,UAAtB,EAAmCyD,OAAD,IAAa;QAC7C5B,QAAQ,CAAC7B,UAAU,CAACyD,OAAD,CAAX,CAAR;QACA5B,QAAQ,CAAC9B,iBAAiB,CAAC;UAAE+C,OAAO,EAAEW,OAAO,CAACC,EAAnB;UAAuBX,WAAW,EAAEU;QAApC,CAAD,CAAlB,CAAR;MACD,CAHD;MAKAnC,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACgE,MAAtB,EAA+B1B,IAAD,IAAU;QACtCJ,QAAQ,CAACpB,iBAAiB,CAACwB,IAAD,CAAlB,CAAR;MACD,CAFD;MAIAX,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACiE,UAAtB,EAAmC3B,IAAD,IAAU;QAC1CJ,QAAQ,CAACjC,cAAc,CAACqC,IAAD,CAAf,CAAR;MACD,CAFD;MAGAX,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACkE,cAAtB,EAAuC5B,IAAD,IAAU;QAC9CJ,QAAQ,CAACjC,cAAc,CAACqC,IAAD,CAAf,CAAR;MACD,CAFD;MAIAX,MAAM,CAACkC,EAAP,CAAU7D,WAAW,CAACO,aAAtB,EAAsCuD,OAAD,IAAY;QAC/C5B,QAAQ,CAAC3B,aAAa,CAACuD,OAAD,CAAd,CAAR;MACD,CAFD;IAGD;;IACD,OAAO,MAAM;MACXnC,MAAM,CAACwC,kBAAP;IACD,CAFD;EAID,CA/DQ,EA+DN,EA/DM,CAAT;EAmEA,oBACE;IAAK,SAAS,EAAC,KAAf;IAAA,WACI,CAACnC,IAAF,iBAAW,QAAC,IAAD;MAAA;MAAA;MAAA;IAAA,QADd,EAEGA,IAAI,iBAAI;MAAA,wBACP;QAAK,SAAS,EAAED,OAAO,CAACb,MAAxB;QAAA,uBACE,QAAC,UAAD;UAAY,MAAM,EAAES;QAApB;UAAA;UAAA;UAAA;QAAA;MADF;QAAA;QAAA;QAAA;MAAA,QADO,eAIP;QAAK,KAAK,EAAE;UAAEP,OAAO,EAAE;QAAX,CAAZ;QAAA,wBACE,QAAC,UAAD;UAAY,MAAM,EAAEO;QAApB;UAAA;UAAA;UAAA;QAAA,QADF,eAEE,QAAC,QAAD;UAAU,MAAM,EAAEA;QAAlB;UAAA;UAAA;UAAA;QAAA,QAFF;MAAA;QAAA;QAAA;QAAA;MAAA,QAJO;IAAA;MAAA;MAAA;MAAA;IAAA,QAFX;EAAA;IAAA;IAAA;IAAA;EAAA,QADF;AAcD,CAxFD;;GAAMG,G;UACYb,S,EAECpB,W;;;KAHbiC,G;AA0FN,eAAeA,GAAf"},"metadata":{},"sourceType":"module"}