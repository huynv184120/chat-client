{"ast":null,"code":"import _regeneratorRuntime from \"/home/huy/chat-module/chat-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/huy/chat-module/chat-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/home/huy/chat-module/chat-client/src/App.js\";\n\nimport './App.css';\nimport Auth from './component/auth';\nimport { makeStyles } from '@material-ui/core';\nimport { SearchRoom } from './component/room';\nimport ChatRoom from './component/chatwindow';\nimport Cookies from 'js-cookie';\nimport { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport io from \"socket.io-client\";\nimport config from './config';\nimport socketEvent from './socket_io/events';\nimport { changeRoomInfo, joinRoom, loadRooms, updateLastMessage } from \"./redux/actions/room\";\nimport { addMessage, loadMessages, updateMessage } from './redux/actions/message';\nimport { roomApi, messageApi, userApi } from './api';\nimport { loadMyInfo, loadUsers, updateMemberInfo } from './redux/actions/user';\nimport { receiveInvitation, loadInvitations } from './redux/actions/announce';\nimport ChatAppBar from './component/ChatAppBar';\nvar useStyles = makeStyles(function () {\n  return {\n    appBar: {\n      height: \"70px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      paddingLeft: \"30px\",\n      paddingRight: \"30px\"\n    },\n    \"@global\": {\n      \"*::-webkit-scrollbar\": {\n        width: \"4px\"\n      },\n      \"*::-webkit-scrollbar-track\": {\n        \"-webkit-box-shadow\": \"inset 0 0 2px rgba(0,0,0,0.00)\"\n      },\n      \"*::-webkit-scrollbar-thumb\": {\n        backgroundColor: \"rgba(0,0,0,0.05)\",\n        outline: \"0.5px solid slategrey\"\n      }\n    }\n  };\n});\nvar socket = io(config.END_POINT, {\n  withCredentials: true\n});\n\nvar App = function App() {\n  var classes = useStyles();\n  var auth = Cookies.get('token');\n  var dispatch = useDispatch();\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var res, rooms, listRoomMess, users, invitations;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!auth) {\n              _context2.next = 23;\n              break;\n            }\n\n            _context2.next = 3;\n            return roomApi.getRooms();\n\n          case 3:\n            res = _context2.sent;\n            rooms = res.data;\n            dispatch(loadRooms(rooms));\n            listRoomMess = rooms.map(function (room) {\n              return messageApi.getMessages(room._id);\n            });\n            _context2.next = 9;\n            return Promise.all(listRoomMess);\n\n          case 9:\n            users = res.users;\n            dispatch(loadMyInfo(res.myInfo));\n            dispatch(loadUsers(users));\n            listRoomMess.forEach(function (element) {\n              element.then(function (data) {\n                dispatch(loadMessages(data));\n                dispatch(updateLastMessage({\n                  room_id: data.room_id,\n                  lastMessage: data.messages[data.messages.length - 1]\n                }));\n              });\n            });\n            invitations = userApi.getinvitations();\n            invitations.then(function (data) {\n              dispatch(loadInvitations(data));\n            }).catch(function () {});\n            socket.emit(socketEvent.online, {\n              token: auth\n            });\n            socket.on(socketEvent.updateMemberInfo, function (data) {\n              dispatch(updateMemberInfo(data));\n            });\n            socket.on(socketEvent.joinRoom, /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(room) {\n                var data;\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        dispatch(joinRoom(room));\n                        _context.next = 3;\n                        return messageApi.getMessages(room._id);\n\n                      case 3:\n                        data = _context.sent;\n                        dispatch(loadMessages(data));\n\n                      case 5:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              }));\n\n              return function (_x) {\n                return _ref2.apply(this, arguments);\n              };\n            }());\n            socket.on(socketEvent.addMessage, function (message) {\n              dispatch(addMessage(message));\n              dispatch(updateLastMessage({\n                room_id: message.to,\n                lastMessage: message\n              }));\n            });\n            socket.on(socketEvent.invite, function (data) {\n              dispatch(receiveInvitation(data));\n            });\n            socket.on(socketEvent.updateRoom, function (data) {\n              dispatch(changeRoomInfo(data));\n            });\n            socket.on(socketEvent.updateRoomInfo, function (data) {\n              dispatch(changeRoomInfo(data));\n            });\n            socket.on(socketEvent.updateMessage, function (message) {\n              dispatch(updateMessage(message));\n            });\n\n          case 23:\n            return _context2.abrupt(\"return\", function () {\n              socket.removeAllListeners();\n            });\n\n          case 24:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 5\n    }\n  }, !auth && /*#__PURE__*/React.createElement(Auth, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 19\n    }\n  }), auth && /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 16\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.appBar,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ChatAppBar, {\n    socket: socket,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: \"flex\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(SearchRoom, {\n    socket: socket,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(ChatRoom, {\n    socket: socket,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default App;","map":{"version":3,"names":["Auth","makeStyles","SearchRoom","ChatRoom","Cookies","useEffect","useState","useDispatch","io","config","socketEvent","changeRoomInfo","joinRoom","loadRooms","updateLastMessage","addMessage","loadMessages","updateMessage","roomApi","messageApi","userApi","loadMyInfo","loadUsers","updateMemberInfo","receiveInvitation","loadInvitations","ChatAppBar","useStyles","appBar","height","display","alignItems","paddingLeft","paddingRight","width","backgroundColor","outline","socket","END_POINT","withCredentials","App","classes","auth","get","dispatch","getRooms","res","rooms","data","listRoomMess","map","room","getMessages","_id","Promise","all","users","myInfo","forEach","element","then","room_id","lastMessage","messages","length","invitations","getinvitations","catch","emit","online","token","on","message","to","invite","updateRoom","updateRoomInfo","removeAllListeners"],"sources":["/home/huy/chat-module/chat-client/src/App.js"],"sourcesContent":["import './App.css';\nimport Auth from './component/auth';\nimport { makeStyles } from '@material-ui/core';\nimport { SearchRoom } from './component/room';\nimport ChatRoom from './component/chatwindow';\nimport Cookies from 'js-cookie';\nimport { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport io from \"socket.io-client\";\nimport config from './config';\nimport socketEvent from './socket_io/events';\nimport { changeRoomInfo, joinRoom, loadRooms, updateLastMessage } from \"./redux/actions/room\";\nimport { addMessage, loadMessages, updateMessage } from './redux/actions/message';\nimport { roomApi, messageApi, userApi } from './api';\nimport { loadMyInfo, loadUsers, updateMemberInfo } from './redux/actions/user';\nimport { receiveInvitation, loadInvitations } from './redux/actions/announce';\nimport ChatAppBar from './component/ChatAppBar';\n\nconst useStyles = makeStyles(() => {\n  return ({\n    appBar: {\n      height: \"70px\",\n      display: \"flex\",\n      alignItems: \"center\",\n      paddingLeft: \"30px\",\n      paddingRight: \"30px\",\n\n    },\n    \"@global\": {\n      \"*::-webkit-scrollbar\": {\n        width: \"4px\",\n      },\n      \"*::-webkit-scrollbar-track\": {\n        \"-webkit-box-shadow\": \"inset 0 0 2px rgba(0,0,0,0.00)\"\n      },\n      \"*::-webkit-scrollbar-thumb\": {\n        backgroundColor: \"rgba(0,0,0,0.05)\",\n        outline: \"0.5px solid slategrey\"\n      }\n    }\n  })\n})\n\nconst socket = io(config.END_POINT, { withCredentials: true });\n\nconst App = () => {\n  const classes = useStyles();\n  const auth = Cookies.get('token');\n  const dispatch = useDispatch();\n\n\n\n  useEffect(async () => {\n    if (auth) {\n\n      const res = await roomApi.getRooms();\n      const rooms = res.data;\n      dispatch(loadRooms(rooms));\n\n      const listRoomMess = rooms.map((room) => messageApi.getMessages(room._id));\n      await Promise.all(listRoomMess);\n      const users = res.users;\n      dispatch(loadMyInfo(res.myInfo));\n      dispatch(loadUsers(users));\n\n      listRoomMess.forEach(element => {\n        element.then((data) => {\n          dispatch(loadMessages(data));\n          dispatch(updateLastMessage({ room_id: data.room_id, lastMessage: data.messages[data.messages.length - 1] }));\n        })\n      });\n\n      const invitations = userApi.getinvitations();\n      invitations.then((data) => {\n        dispatch(loadInvitations(data));\n      }).catch(() => { })\n\n\n      socket.emit(socketEvent.online, { token: auth });\n\n      socket.on(socketEvent.updateMemberInfo, (data) => {\n        dispatch(updateMemberInfo(data));\n      });\n\n      socket.on(socketEvent.joinRoom, async (room) => {\n        dispatch(joinRoom(room));\n        const data = await messageApi.getMessages(room._id);\n        dispatch(loadMessages(data));\n\n      });\n\n      socket.on(socketEvent.addMessage, (message) => {\n        dispatch(addMessage(message));\n        dispatch(updateLastMessage({ room_id: message.to, lastMessage: message }));\n      });\n\n      socket.on(socketEvent.invite, (data) => {\n        dispatch(receiveInvitation(data));\n      });\n\n      socket.on(socketEvent.updateRoom, (data) => {\n        dispatch(changeRoomInfo(data));\n      });\n      socket.on(socketEvent.updateRoomInfo, (data) => {\n        dispatch(changeRoomInfo(data));\n      });\n\n      socket.on(socketEvent.updateMessage, (message)=> {\n        dispatch(updateMessage(message));\n      });\n    }\n    return () => {\n      socket.removeAllListeners();\n    }\n\n  }, [])\n\n\n\n  return (\n    <div className=\"App\">\n      {(!auth) && <Auth />}\n      {auth && <div>\n        <div className={classes.appBar}>\n          <ChatAppBar socket={socket} />\n        </div>\n        <div style={{ display: \"flex\" }}>\n          <SearchRoom socket={socket} />\n          <ChatRoom socket={socket} />\n        </div>\n      </div>}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}